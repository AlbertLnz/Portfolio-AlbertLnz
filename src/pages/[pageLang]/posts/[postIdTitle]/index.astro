---
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('posts')
  const paths = []

  for (const post of posts) {
    const { id, title, language } = post.data
    const titleCleaned = title.normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/[^\w\s-]/g, '').replaceAll(' ', '-').toLowerCase()
    paths.push({
      params: {
        pageLang: language,
        postIdTitle: `${id}-${titleCleaned}`,
      },
    })
  }
  return paths
}

const posts = await getCollection('posts')
const { pageLang, postIdTitle } = Astro.params
const [id] = postIdTitle.split('/')[0]
const post = posts.find((post) => post.data.id === Number(id) && post.data.language === pageLang)
---

<h1>{pageLang}</h1>
<h2>ID: {id}</h2>
<h2>Titulo: {post.data.title}</h2>
